<!-- templates/edit_element_competence.html -->
{% extends 'base.html' %}

{% block head %}
  {{ super() }}
  {{ ckeditor.load() }}
{% endblock %}

{% block content %}
  <div class="container mt-5">
    <h2>Modifier Élément de Compétence</h2>
    <form method="POST">
      {{ form.hidden_tag() }}

      <div class="form-group">
        <label for="{{ form.competence.id }}">{{ form.competence.label }}</label>
        {{ form.competence(class="form-control") }}
        <small class="form-text text-muted">Sélectionnez la compétence associée.</small>
      </div>

      <div class="form-group">
        <label for="{{ form.nom.id }}">{{ form.nom.label }}</label>
        {{ form.nom(class="form-control") }}
      </div>

      <!-- Champ Criteres_de_performance : FieldList de TextArea par exemple -->
      <div class="form-group">
        <h4>Critères de Performance</h4>
        {% for critere_field in form.criteres_de_performance %}
          <div class="mb-2">
            {{ critere_field(class="form-control", rows="3") }}
          </div>
        {% endfor %}
        <button type="button" class="btn btn-secondary" id="add-critere">Ajouter un Critère</button>
      </div>

      <button type="submit" class="btn btn-primary">Mettre à Jour</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var addCritereButton = document.getElementById('add-critere');
      var criteresContainer = document.querySelectorAll('[name^="criteres_de_performance-"]');
      var index = {{ form.criteres_de_performance|length }};

      addCritereButton.addEventListener('click', function() {
        if (index >= 10) {
          alert('Nombre maximal de critères atteint.');
          return;
        }

        // Créer un nouveau text-area dynamique
        var newCritere = document.createElement('textarea');
        newCritere.classList.add('form-control', 'mb-2');
        newCritere.name = `criteres_de_performance-${index}`;
        newCritere.rows = 3;
        addCritereButton.parentElement.insertBefore(newCritere, addCritereButton);
        index++;
      });
    });
  </script>
{% endblock %}
